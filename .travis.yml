---
sudo: true

language: java

jdk: oraclejdk8

before_install:
   - sudo apt-get install rpm

script:
   - mvn -B clean install
   - mkdir -p ~/rpmbuild/SOURCES
   - cp target/*jar ~/rpmbuild/SOURCES
   - export VERSION=$(sed -n '0,/^.*<version>\(.*\)<\/version>.*$/s//\1/p' pom.xml)
   - rpmbuild -ba -D "version ${VERSION}" paella-opencast.spec

after_success:
   - curl -i -s -f -u "${PKGUPLOADUSER}:${PKGUPLOADPASS}"
     -F file=@${HOME}/rpmbuild/RPMS/x86_64/paella-opencast-${VERSION}-1.x86_64.rpm
     https://pkg.opencast.org/upload
